<div class="carbon-container animate-in">
  <div class="d-flex justify-content-between align-items-end mb-4">
    <div>
      <h3 class="fw-bold text-dark mb-1">บันทึกกิจกรรมก๊าซเรือนกระจก</h3>
      <p class="text-muted small mb-0">บันทึกข้อมูลการใช้พลังงานเพื่อคำนวณ Carbon Footprint (Scope 1, 2, 3)</p>
    </div>
    <div class="actions">
      <button class="btn btn-outline-success border-2 fw-bold px-4 rounded-3 me-2" data-bs-toggle="modal" data-bs-target="#aiModal">
        <i class="fa-solid fa-wand-magic-sparkles me-2"></i>AI Scan Bill
      </button>
      <button class="btn btn-success fw-bold px-4 rounded-3 shadow-sm" data-bs-toggle="modal" data-bs-target="#manualModal">
        <i class="fa-solid fa-plus me-2"></i>เพิ่มข้อมูลใหม่
      </button>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="stat-card p-3 rounded-4 border-0 shadow-sm bg-white">
        <div class="d-flex align-items-center gap-3">
          <div class="icon-box bg-primary-subtle text-primary"><i class="fa-solid fa-bolt"></i></div>
          <div>
            <p class="text-muted small mb-0">ไฟฟ้าเดือนนี้</p>
            <h4 class="fw-bold mb-0">1,245.0 <small class="fs-6">kWh</small></h4>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card p-3 rounded-4 border-0 shadow-sm bg-white">
        <div class="d-flex align-items-center gap-3">
          <div class="icon-box bg-info-subtle text-info"><i class="fa-solid fa-droplet"></i></div>
          <div>
            <p class="text-muted small mb-0">ค่าน้ำประปา</p>
            <h4 class="fw-bold mb-0">45.2 <small class="fs-6">m³</small></h4>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card p-3 rounded-4 border-0 shadow-sm bg-white">
        <div class="d-flex align-items-center gap-3">
          <div class="icon-box bg-danger-subtle text-danger"><i class="fa-solid fa-cloud-arrow-up"></i></div>
          <div>
            <p class="text-muted small mb-0">รวมการปล่อยก๊าซ</p>
            <h4 class="fw-bold mb-0">512.8 <small class="fs-6">kgCO2e</small></h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
      <h5 class="mb-0 fw-bold">รายการบันทึกล่าสุด</h5>
      <div class="d-flex gap-2">
        <input type="text" class="form-control form-control-sm rounded-3" placeholder="ค้นหาประเภทกิจกรรม...">
        <select class="form-select form-select-sm rounded-3 w-auto">
          <option>ทุกไตรมาส</option>
          <option>Q1 2024</option>
        </select>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th class="ps-4">วันที่บันทึก</th>
            <th>ประเภทกิจกรรม</th>
            <th>ปริมาณที่ใช้</th>
            <th>หน่วย</th>
            <th>การปล่อยก๊าซ (kgCO2e)</th>
            <th>ที่มาข้อมูล</th>
            <th class="text-end pe-4">จัดการ</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of logs">
            <td class="ps-4 text-muted small">{{ log.date | date:'dd MMM yyyy' }}</td>
            <td>
              <div class="d-flex align-items-center">
                <span class="type-dot me-2" [ngClass]="log.type"></span>
                <span class="fw-bold">{{ log.type }}</span>
              </div>
            </td>
            <td>{{ log.amount | number }}</td>
            <td><span class="badge bg-light text-dark fw-normal">{{ log.unit }}</span></td>
            <td><span class="text-danger fw-bold">{{ log.emission | number:'1.2-2' }}</span></td>
            <td>
              <span class="badge rounded-pill" [ngClass]="log.source === 'AI_OCR' ? 'bg-primary-subtle text-primary' : 'bg-secondary-subtle text-secondary'">
                <i class="fa-solid me-1" [ngClass]="log.source === 'AI_OCR' ? 'fa-robot' : 'fa-keyboard'"></i>
                {{ log.source }}
              </span>
            </td>
            <td class="text-end pe-4">
              <button class="btn btn-sm btn-light rounded-circle me-1"><i class="fa-solid fa-eye text-muted"></i></button>
              <button class="btn btn-sm btn-light rounded-circle"><i class="fa-solid fa-trash text-danger"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="aiModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 p-4 text-center">
      <div class="mb-3">
        <div class="ai-upload-zone p-5 border-2 border-dashed rounded-4" (click)="fileInput.click()">
          <input type="file" #fileInput hidden (change)="onFileSelected($event)">
          <i class="fa-solid fa-file-invoice text-success display-4 mb-3"></i>
          <h5>คลิกเพื่ออัปโหลดบิลค่าพลังงาน</h5>
          <p class="text-muted small">ระบบจะใช้ AI ดึงข้อมูลจากไฟล์ภาพหรือ PDF ให้อัตโนมัติ</p>
        </div>
      </div>
      <div *ngIf="isScanning" class="py-3">
        <div class="spinner-border text-success mb-2"></div>
        <p class="mb-0 fw-bold">AI กำลังวิเคราะห์ข้อมูล...</p>
      </div>
    </div>
  </div>
</div>